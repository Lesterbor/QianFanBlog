name: Deploy QianFanBlog
on:
  push:
    branches: [ main ]  # åªåœ¨æ¨é€åˆ°mainåˆ†æ”¯æ—¶è§¦å‘

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: SSH Deploy and Build
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          port: ${{ secrets.PORT }}
          script: |
            # è¿›å…¥é¡¹ç›®ç›®å½•
            cd /var/www/QianFanBlog || exit 1
            
            # æ›´æ–°ä»£ç 
            echo "ğŸ”„ æ›´æ–°ä»£ç ..."
            git fetch origin main
            git checkout main
            git reset --hard origin/main
            
            # å®‰è£…ä¾èµ–å¹¶æ„å»º
            echo "ğŸ”§ å®‰è£…ä¾èµ–..."
            npm install
            
            echo "ğŸ—ï¸ æ„å»ºé¡¹ç›®..."
            npm run build
            
            # å¤åˆ¶æ„å»ºæ–‡ä»¶åˆ°WebæœåŠ¡å™¨ç›®å½•
            echo "ğŸš€ éƒ¨ç½²åˆ°Webç›®å½•..."
            rm -rf /var/www/html/*
            cp -a dist/* /var/www/html/
            
            # é‡å¯Nginx (å¦‚æœéœ€è¦)
            echo "ğŸ”„ é‡å¯Nginx..."
            sudo systemctl restart nginx
            
            echo "âœ… éƒ¨ç½²æˆåŠŸï¼"