- name: Deploy to Server via SSH
  uses: appleboy/ssh-action@v1
  with:
    host: ${{ secrets.SSH_HOST }}
    username: ${{ secrets.SSH_USERNAME }}
    key: ${{ secrets.SSH_PRIVATE_KEY }}
    script_timeout: 15m
    envs: CI=true
    debug: true
    script: |
      echo "=== 环境验证 ==="
      whoami
      pwd
      ls -la /var/www/QianFanBlog
      
      echo "=== 开始部署 ==="
      cd /var/www/QianFanBlog
      git config --global --add safe.directory /var/www/QianFanBlog
      git reset --hard HEAD
      git pull origin main
      npm ci --omit=dev
      npm run build
      
      echo "=== 权限修复 ==="
      chown -R ${{ secrets.SSH_USERNAME }}:www-data /var/www/QianFanBlog
      find . -type d -exec chmod 755 {} \;
      find . -type f -exec chmod 644 {} \;