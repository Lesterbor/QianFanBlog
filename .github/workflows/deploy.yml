- name: Deploy via SSH
  uses: appleboy/ssh-action@v1
  with:
    host: ${{ secrets.SSH_HOST }}
    username: ${{ secrets.SSH_USERNAME }}
    key: ${{ secrets.SSH_PRIVATE_KEY }}
    timeout: 60  # 单位秒
    command_timeout: 30m  # 长超时设置
    debug: true
    script: |
      set -ex
      echo "=== 环境诊断 ==="
      ls -la /var/www
      stat /var/www/QianFanBlog || sudo mkdir -p /var/www/QianFanBlog
      
      echo "=== 密钥验证 ==="
      mkdir -p ~/.ssh
      echo "$SSH_PUBLIC_KEY" >> ~/.ssh/authorized_keys
      chmod 600 ~/.ssh/authorized_keys
      
      echo "=== 部署开始 ==="
      cd /var/www/QianFanBlog
      git config --global --add safe.directory .
      git reset --hard
      git pull origin main
      npm ci --omit=dev
      npm run build